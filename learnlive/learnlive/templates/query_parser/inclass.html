{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Qurious</title>

    <!-- Bootstrap core CSS -->
 	<link href="{% static 'bootstrap/css/bootstrap.css' %}" rel="stylesheet">
    <link href="{% static 'query_parser/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'query_parser/starter-template.css' %}" rel="stylesheet">
    <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>

  </head>

  <body>

  	<script type="text/javascript">
	  var apiKey    = "44594972";
	  var sessionId = "2_MX40NDU5NDk3Mn5-U3VuIERlYyAyOSAwNDozNTo0MiBQU1QgMjAxM34wLjY2MjY5MDJ-";
	  var token     = "T1==cGFydG5lcl9pZD00NDU5NDk3MiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1kYmFlMGZkNWRhN2U2MzEwMjg4MGM0MDEwYjY3MWE1OWY4MGVhNmVlOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9Ml9NWDQwTkRVNU5EazNNbjUtVTNWdUlFUmxZeUF5T1NBd05Eb3pOVG8wTWlCUVUxUWdNakF4TTM0d0xqWTJNalk1TURKLSZjcmVhdGVfdGltZT0xMzg4MzIwNTU5Jm5vbmNlPTAuMzgxNDgyOTgwNDI1NzI0MjYmZXhwaXJlX3RpbWU9MTM4ODQwNjk1OSZjb25uZWN0aW9uX2RhdGE9";
	 
	  function sessionConnectedHandler (event) {
	     session.publish( publisher );
	     subscribeToStreams(event.streams);
	  }

	  function subscribeToStreams(streams) {
	    for (var i = 0; i < streams.length; i++) {
	        var stream = streams[i];
	        if (stream.connection.connectionId 
	               != session.connection.connectionId) {
	            session.subscribe(stream);
	        }
	    }
	  }

	  function streamCreatedHandler(event) {
	    subscribeToStreams(event.streams);
	  }
	 
	  var publisher = TB.initPublisher(apiKey,
                                 "myPublisher",
                                 {width: 1900, height:900})
	  var session   = TB.initSession(sessionId);
	 
	  session.connect(apiKey, token);
	  session.addEventListener("sessionConnected", 
	                           sessionConnectedHandler);
	 
	  session.addEventListener("streamCreated", 
	                           streamCreatedHandler);
	</script>

  </body>
</html>
